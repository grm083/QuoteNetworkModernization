<?xml version="1.0" encoding="UTF-8"?>
<Flow xmlns="http://soap.sforce.com/2006/04/metadata">
    <actionCalls>
        <name>Get_Email_Task_Record_Type</name>
        <label>Get Email Task Record Type</label>
        <locationX>956</locationX>
        <locationY>633</locationY>
        <actionName>GetSobjectRecordTypeId</actionName>
        <actionType>apex</actionType>
        <connector>
            <targetReference>Get_Team_User_By_Email</targetReference>
        </connector>
        <flowTransactionModel>CurrentTransaction</flowTransactionModel>
        <inputParameters>
            <name>inputParameter</name>
            <value>
                <elementReference>varEmailRecordType</elementReference>
            </value>
        </inputParameters>
        <nameSegment>GetSobjectRecordTypeId</nameSegment>
        <offset>0</offset>
        <outputParameters>
            <assignToReference>varEmailRecordTypeId</assignToReference>
            <name>output</name>
        </outputParameters>
    </actionCalls>
    <actionCalls>
        <name>Get_Genesys_Record_Type</name>
        <label>Get Genesys Record Type</label>
        <locationX>574</locationX>
        <locationY>430</locationY>
        <actionName>GetSobjectRecordTypeId</actionName>
        <actionType>apex</actionType>
        <connector>
            <targetReference>Get_Record_Type_Name</targetReference>
        </connector>
        <flowTransactionModel>CurrentTransaction</flowTransactionModel>
        <inputParameters>
            <name>inputParameter</name>
            <value>
                <elementReference>GetGenesysRoutingRecordType</elementReference>
            </value>
        </inputParameters>
        <nameSegment>GetSobjectRecordTypeId</nameSegment>
        <offset>0</offset>
        <outputParameters>
            <assignToReference>varGenesysRecordTypeId</assignToReference>
            <name>output</name>
        </outputParameters>
    </actionCalls>
    <actionCalls>
        <name>Get_Team_User_By_Email</name>
        <label>Get Team User By Email</label>
        <locationX>1122</locationX>
        <locationY>631</locationY>
        <actionName>UserSelector</actionName>
        <actionType>apex</actionType>
        <connector>
            <targetReference>Check_Team_User_Record</targetReference>
        </connector>
        <flowTransactionModel>CurrentTransaction</flowTransactionModel>
        <inputParameters>
            <name>toEmail</name>
            <value>
                <elementReference>varEmailToAddress1</elementReference>
            </value>
        </inputParameters>
        <nameSegment>UserSelector</nameSegment>
        <offset>0</offset>
        <outputParameters>
            <assignToReference>userCSRRecord</assignToReference>
            <name>output</name>
        </outputParameters>
    </actionCalls>
    <actionCalls>
        <name>Get_To_Address</name>
        <label>Get To Address</label>
        <locationX>1106</locationX>
        <locationY>262</locationY>
        <actionName>GetToAddress</actionName>
        <actionType>apex</actionType>
        <connector>
            <targetReference>Iterate_Email_Address</targetReference>
        </connector>
        <flowTransactionModel>CurrentTransaction</flowTransactionModel>
        <inputParameters>
            <name>lstEmailMessage</name>
            <value>
                <elementReference>varEMList</elementReference>
            </value>
        </inputParameters>
        <nameSegment>GetToAddress</nameSegment>
        <offset>0</offset>
        <outputParameters>
            <assignToReference>varEmailToAddress</assignToReference>
            <name>output</name>
        </outputParameters>
    </actionCalls>
    <actionCalls>
        <description>To fetch service flag</description>
        <name>getFlag</name>
        <label>getFlag</label>
        <locationX>775</locationX>
        <locationY>636</locationY>
        <actionName>GetSFDCServiceFlag</actionName>
        <actionType>apex</actionType>
        <connector>
            <targetReference>Get_Email_Task_Record_Type</targetReference>
        </connector>
        <faultConnector>
            <targetReference>Get_Email_Task_Record_Type</targetReference>
        </faultConnector>
        <flowTransactionModel>CurrentTransaction</flowTransactionModel>
        <inputParameters>
            <name>inputstr</name>
            <value>
                <elementReference>varCaseRecord.Last_Agent_ID__c</elementReference>
            </value>
        </inputParameters>
        <nameSegment>GetSFDCServiceFlag</nameSegment>
        <offset>0</offset>
        <outputParameters>
            <assignToReference>varSFDCFlag</assignToReference>
            <name>output</name>
        </outputParameters>
    </actionCalls>
    <apiVersion>49.0</apiVersion>
    
    <assignments>
        <name>Assign_ETC_MediaType</name>
        <label>Assign ETC MediaType</label>
        <locationX>761</locationX>
        <locationY>2189</locationY>
        <assignmentItems>
            <assignToReference>varMediaType</assignToReference>
            <operator>Assign</operator>
            <value>
                <stringValue>SFDCEmailCase</stringValue>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Check_the_Email_Count</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Assign_Genesys_Enable_Service_Flag</name>
        <label>Assign Genesys Enable Service Flag</label>
        <locationX>1201</locationX>
        <locationY>907</locationY>
        <assignmentItems>
            <assignToReference>varSFDCFlag</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>userCSRRecord.GR_Service_Flag__c</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Get_Genesys_User</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Assign_Is_New_Email_For_Email_Count_0</name>
        <label>Assign Is New Email For Email Count 0</label>
        <locationX>760</locationX>
        <locationY>2434</locationY>
        <assignmentItems>
            <assignToReference>VarIsEmailNew</assignToReference>
            <operator>Assign</operator>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Create_Genesys_Routing_Record</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Assign_IsNewEmail_For_Default_Email</name>
        <label>Assign IsNewEmail For Default Email</label>
        <locationX>1238</locationX>
        <locationY>2431</locationY>
        <assignmentItems>
            <assignToReference>VarIsEmailNew</assignToReference>
            <operator>Assign</operator>
            <value>
                <booleanValue>false</booleanValue>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Create_Genesys_Routing_Record</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Assign_MediaType</name>
        <label>Assign MediaType</label>
        <locationX>1236</locationX>
        <locationY>2186</locationY>
        <assignmentItems>
            <assignToReference>varMediaType</assignToReference>
            <operator>Assign</operator>
            <value>
                <stringValue>SFDCEmailTask</stringValue>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Check_the_Email_Count</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Assign_Non_Genesys_User_Id</name>
        <label>Assign Non Genesys User Id</label>
        <locationX>654</locationX>
        <locationY>1085</locationY>
        <assignmentItems>
            <assignToReference>varUserId</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>userCSRRecord.SFDC_user_Id__c</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Create_Task</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Assign_Service_Flag_For_Non_LastAgentId_and_Email_UCC</name>
        <label>Assign Service Flag For Non LastAgentId and Email UCC</label>
        <locationX>951</locationX>
        <locationY>1102</locationY>
        <assignmentItems>
            <assignToReference>varSFDCFlag</assignToReference>
            <operator>Assign</operator>
            <value>
                <stringValue>CS</stringValue>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Get_Genesys_User</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Assign_Value</name>
        <label>Assign Value</label>
        <locationX>1095</locationX>
        <locationY>428</locationY>
        <assignmentItems>
            <assignToReference>varEmailToAddress1</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>varObj</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Iterate_Email_Address</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Existing_Email_Count</name>
        <label>Existing Email Count</label>
        <locationX>997</locationX>
        <locationY>1909</locationY>
        <assignmentItems>
            <assignToReference>emailCount</assignToReference>
            <operator>AssignCount</operator>
            <value>
                <elementReference>Get_Email_Records</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Check_Email_to_Case</targetReference>
        </connector>
    </assignments>
    <constants>
        <name>GENESYSUSER</name>
        <dataType>String</dataType>
        <value>
            <stringValue>Genesys User</stringValue>
        </value>
    </constants>
    <decisions>
        <name>Check_Email_to_Case</name>
        <label>Check Email to Case</label>
        <locationX>989</locationX>
        <locationY>2063</locationY>
        <defaultConnector>
            <targetReference>Assign_MediaType</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>If_Email_to_Case</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>varCaseRecordType</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Standard Case</stringValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>emailCount</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <numberValue>0.0</numberValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>varCaseRecord.Last_Agent_ID__c</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>varCaseCreatedByName</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Email Admin</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Assign_ETC_MediaType</targetReference>
            </connector>
            <label>If Email to Case</label>
        </rules>
    </decisions>
    <decisions>
        <name>Check_Is_Genesys_Enable_User</name>
        <label>Check Is Genesys Enable User</label>
        <locationX>988</locationX>
        <locationY>1411</locationY>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>Check_Is_Genesys_Enable</name>
            <conditionLogic>(1 AND 2) OR 3</conditionLogic>
            <conditions>
                <leftValueReference>userCSRRecord</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>userCSRRecord.Is_Genesys_User__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>userCSRRecord</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Get_Email_Type</targetReference>
            </connector>
            <label>Check Is Genesys Enable</label>
        </rules>
    </decisions>
    <decisions>
        <name>Check_Team_User_Record</name>
        <label>Check Team User Record</label>
        <locationX>947</locationX>
        <locationY>903</locationY>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>Is_Genesys_User_Enable</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>userCSRRecord</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>userCSRRecord.Is_Genesys_User__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Assign_Genesys_Enable_Service_Flag</targetReference>
            </connector>
            <label>Is Genesys User Enable</label>
        </rules>
        <rules>
            <name>Is_Genesys_User_Disable</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>userCSRRecord</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>userCSRRecord.Is_Genesys_User__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Assign_Non_Genesys_User_Id</targetReference>
            </connector>
            <label>Is Genesys User Disable</label>
        </rules>
        <rules>
            <name>When_No_Email_UCC</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>userCSRRecord</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Assign_Service_Flag_For_Non_LastAgentId_and_Email_UCC</targetReference>
            </connector>
            <label>When No Email UCC</label>
        </rules>
    </decisions>
    <decisions>
        <name>Check_the_Email_Count</name>
        <label>Check the Email Count</label>
        <locationX>984</locationX>
        <locationY>2309</locationY>
        <defaultConnector>
            <targetReference>Assign_IsNewEmail_For_Default_Email</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>Email_Count_0</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>emailCount</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <numberValue>0.0</numberValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>varCaseRecord.Last_Agent_ID__c</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>Get_Email_Type</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Assign_Is_New_Email_For_Email_Count_0</targetReference>
            </connector>
            <label>Email Count 0</label>
        </rules>
    </decisions>
    <description>Updated for Sprint 2.25</description>
    <environments>Default</environments>
    <interviewLabel>Create Genesys Routing {!$Flow.CurrentDateTime}</interviewLabel>
    <label>Create Genesys Routing</label>
    <loops>
        <name>Iterate_Email_Address</name>
        <label>Iterate Email Address</label>
        <locationX>844</locationX>
        <locationY>429</locationY>
        <assignNextValueToReference>varObj</assignNextValueToReference>
        <collectionReference>varEmailToAddress</collectionReference>
        <iterationOrder>Asc</iterationOrder>
        <nextValueConnector>
            <targetReference>Assign_Value</targetReference>
        </nextValueConnector>
        <noMoreValuesConnector>
            <targetReference>Get_Genesys_Record_Type</targetReference>
        </noMoreValuesConnector>
    </loops>
    <processMetadataValues>
        <name>BuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>CanvasMode</name>
        <value>
            <stringValue>FREE_FORM_CANVAS</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>OriginBuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processType>AutoLaunchedFlow</processType>
    <recordCreates>
        <name>Create_Genesys_Routing_Record</name>
        <label>Create Genesys Routing Record</label>
        <locationX>991</locationX>
        <locationY>2521</locationY>
        <assignRecordIdToReference>varGenesysRoutingId</assignRecordIdToReference>
        <inputAssignments>
            <field>EmailFrom__c</field>
            <value>
                <elementReference>varEmailFrom</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>EmailSubject__c</field>
            <value>
                <elementReference>varEmailSubject</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>EmailTo__c</field>
            <value>
                <elementReference>varEmailToAddress1</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Email_Message_Id__c</field>
            <value>
                <elementReference>varMessageId</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Integrate_with_Genesys_Routing__c</field>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>LastAgentId__c</field>
            <value>
                <elementReference>varCaseRecord.Last_Agent_ID__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>MediaType__c</field>
            <value>
                <elementReference>varMediaType</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>RecordTypeId</field>
            <value>
                <elementReference>varGenesysRecordTypeId</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>SFDCAcctID__c</field>
            <value>
                <elementReference>varCaseRecord.Customer_Code__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>SFDCAcctLocation__c</field>
            <value>
                <elementReference>varCaseLocationId</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>SFDCAcctSegment__c</field>
            <value>
                <elementReference>varAccountSegment</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>SFDCCaseNumber__c</field>
            <value>
                <elementReference>varCaseNumber</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>SFDCCaseReason__c</field>
            <value>
                <elementReference>varCaseRecord.Case_Reason__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>SFDCCaseRefNo__c</field>
            <value>
                <elementReference>varCaseReferenceNumber</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>SFDCCaseSubCaseType__c</field>
            <value>
                <elementReference>varCaseRecord.Case_Sub_Type__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>SFDCCaseType__c</field>
            <value>
                <elementReference>varCaseRecord.Case_Type__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>SFDCIsAcctVendor__c</field>
            <value>
                <elementReference>varIsAccountVendor</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>SFDCIsEmailNew__c</field>
            <value>
                <elementReference>VarIsEmailNew</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>SFDCObjName__c</field>
            <value>
                <stringValue>Case</stringValue>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>SFDCObjRecordID__c</field>
            <value>
                <elementReference>varEMList.Id</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>SFDCObjType__c</field>
            <value>
                <stringValue>EmailMessage</stringValue>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>SFDCRecordType__c</field>
            <value>
                <elementReference>varCaseRecordType</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>SFDCServiceFlag__c</field>
            <value>
                <elementReference>varSFDCFlag</elementReference>
            </value>
        </inputAssignments>
        <object>Genesys_Routing__c</object>
    </recordCreates>
    <recordCreates>
        <name>Create_Task</name>
        <label>Create Task</label>
        <locationX>996</locationX>
        <locationY>1248</locationY>
        <assignRecordIdToReference>varCreatedTask.Id</assignRecordIdToReference>
        <connector>
            <targetReference>Check_Is_Genesys_Enable_User</targetReference>
        </connector>
        <inputAssignments>
            <field>ActivityDate</field>
            <value>
                <elementReference>$Flow.CurrentDate</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Contact_Email__c</field>
            <value>
                <elementReference>varEmailFrom</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Email_Id__c</field>
            <value>
                <elementReference>varMessageId</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Email_To__c</field>
            <value>
                <elementReference>varEmailTo</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Last_Agent_ID__c</field>
            <value>
                <elementReference>varLastAgentId</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>OwnerId</field>
            <value>
                <elementReference>varUserId</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Priority</field>
            <value>
                <stringValue>Normal</stringValue>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>RecordTypeId</field>
            <value>
                <elementReference>varEmailRecordTypeId</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Status</field>
            <value>
                <stringValue>Open</stringValue>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Subject</field>
            <value>
                <elementReference>varEmailSubject</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>TaskFromEmail__c</field>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>WhatId</field>
            <value>
                <elementReference>varEmailCaseId</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>WhoId</field>
            <value>
                <elementReference>varContactName</elementReference>
            </value>
        </inputAssignments>
        <object>Task</object>
    </recordCreates>
    <recordLookups>
        <name>Get_Case_Created_By_Name</name>
        <label>Get Case Created By Name</label>
        <locationX>836</locationX>
        <locationY>264</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Get_To_Address</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>varCaseRecord.CreatedById</elementReference>
            </value>
        </filters>
        <object>User</object>
        <outputAssignments>
            <assignToReference>varCaseCreatedByName</assignToReference>
            <field>Name</field>
        </outputAssignments>
    </recordLookups>
    <recordLookups>
        <name>Get_Case_Record</name>
        <label>Get Case Record</label>
        <locationX>619</locationX>
        <locationY>263</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Get_Case_Created_By_Name</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>varEmailCaseId</elementReference>
            </value>
        </filters>
        <object>Case</object>
        <outputReference>varCaseRecord</outputReference>
        <queriedFields>Id</queriedFields>
        <queriedFields>Case_Sub_Type__c</queriedFields>
        <queriedFields>Case_Type__c</queriedFields>
        <queriedFields>Case_Reason__c</queriedFields>
        <queriedFields>LastModifiedDate</queriedFields>
        <queriedFields>LastModifiedById</queriedFields>
        <queriedFields>Last_Agent_ID__c</queriedFields>
        <queriedFields>RecordTypeId</queriedFields>
        <queriedFields>Customer_Code__c</queriedFields>
        <queriedFields>CreatedById</queriedFields>
    </recordLookups>
    <recordLookups>
        <name>Get_Email_Records</name>
        <label>Get Email Records</label>
        <locationX>997</locationX>
        <locationY>1766</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Existing_Email_Count</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>ParentId</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>varEmailCaseId</elementReference>
            </value>
        </filters>
        <filters>
            <field>Id</field>
            <operator>NotEqualTo</operator>
            <value>
                <elementReference>varEmailMessageId</elementReference>
            </value>
        </filters>
        <filters>
            <field>Incoming</field>
            <operator>EqualTo</operator>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </filters>
        <getFirstRecordOnly>false</getFirstRecordOnly>
        <object>EmailMessage</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordLookups>
        <name>Get_Email_Type</name>
        <label>Get Email Type</label>
        <locationX>997</locationX>
        <locationY>1622</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Get_Email_Records</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>ParentId</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>varEmailCaseId</elementReference>
            </value>
        </filters>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>varEmailMessageId</elementReference>
            </value>
        </filters>
        <filters>
            <field>Incoming</field>
            <operator>EqualTo</operator>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </filters>
        <filters>
            <field>In_Reply_To_ID__c</field>
            <operator>IsNull</operator>
            <value>
                <booleanValue>false</booleanValue>
            </value>
        </filters>
        <getFirstRecordOnly>false</getFirstRecordOnly>
        <object>EmailMessage</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordLookups>
        <name>Get_Genesys_User</name>
        <label>Get Genesys User</label>
        <locationX>1203</locationX>
        <locationY>1110</locationY>
        <assignNullValuesIfNoRecordsFound>true</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Create_Task</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Label</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>GENESYSUSER</elementReference>
            </value>
        </filters>
        <object>Generic_Values__mdt</object>
        <outputAssignments>
            <assignToReference>varUserId</assignToReference>
            <field>Id__c</field>
        </outputAssignments>
    </recordLookups>
    <recordLookups>
        <name>Get_Record_Type_Name</name>
        <label>Get Record Type Name</label>
        <locationX>575</locationX>
        <locationY>587</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>getFlag</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>varCaseRecord.RecordTypeId</elementReference>
            </value>
        </filters>
        <object>RecordType</object>
        <outputAssignments>
            <assignToReference>varCaseRecordType</assignToReference>
            <field>Name</field>
        </outputAssignments>
    </recordLookups>
    <start>
        <locationX>765</locationX>
        <locationY>50</locationY>
        <connector>
            <targetReference>Get_Case_Record</targetReference>
        </connector>
    </start>
    <status>Active</status>
    <variables>
        <name>emailCount</name>
        <dataType>Number</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <scale>0</scale>
    </variables>
    <variables>
        <name>GenesysRecordId</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>GetGenesysRoutingRecordType</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <value>
            <stringValue>Genesys_Routing__c;Email_to_Case</stringValue>
        </value>
    </variables>
    <variables>
        <name>getreccordsforfirsttask</name>
        <dataType>SObject</dataType>
        <isCollection>true</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>EmailMessage</objectType>
    </variables>
    <variables>
        <name>objEmailMessage</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>false</isOutput>
        <objectType>EmailMessage</objectType>
    </variables>
    <variables>
        <name>userCSRRecord</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>CSR_User_Data_Setup__mdt</objectType>
    </variables>
    <variables>
        <name>varAccountSegment</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>true</isOutput>
    </variables>
    <variables>
        <name>varCaseAccountId</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>true</isOutput>
    </variables>
    <variables>
        <name>varCaseCreatedByName</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>varCaseLastModified</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>true</isOutput>
    </variables>
    <variables>
        <name>varCaseLocationId</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>true</isOutput>
    </variables>
    <variables>
        <name>varCaseNumber</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>true</isOutput>
    </variables>
    <variables>
        <name>varCaseRecord</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>true</isOutput>
        <objectType>Case</objectType>
    </variables>
    <variables>
        <name>varCaseRecordType</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>true</isOutput>
    </variables>
    <variables>
        <name>varCaseReferenceNumber</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>true</isOutput>
    </variables>
    <variables>
        <name>varContactName</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>true</isOutput>
    </variables>
    <variables>
        <name>varCreatedTask</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>Task</objectType>
    </variables>
    <variables>
        <name>varEmailBody</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>true</isOutput>
    </variables>
    <variables>
        <name>varEmailCaseId</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>true</isOutput>
    </variables>
    <variables>
        <name>varEmailCC</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>true</isOutput>
    </variables>
    <variables>
        <name>varEmailFrom</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>true</isOutput>
    </variables>
    <variables>
        <name>varEmailMessageId</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>true</isOutput>
    </variables>
    <variables>
        <name>varEmailMessageList</name>
        <dataType>SObject</dataType>
        <isCollection>true</isCollection>
        <isInput>true</isInput>
        <isOutput>false</isOutput>
        <objectType>EmailMessage</objectType>
    </variables>
    <variables>
        <name>varEmailRecordType</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>true</isOutput>
        <value>
            <stringValue>Task;Email_to_Case</stringValue>
        </value>
    </variables>
    <variables>
        <name>varEmailRecordTypeId</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>varEmailSubject</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>true</isOutput>
    </variables>
    <variables>
        <name>varEmailTo</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>true</isOutput>
    </variables>
    <variables>
        <name>varEmailToAddress</name>
        <dataType>String</dataType>
        <isCollection>true</isCollection>
        <isInput>true</isInput>
        <isOutput>true</isOutput>
    </variables>
    <variables>
        <name>varEmailToAddress1</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>true</isOutput>
    </variables>
    <variables>
        <name>varEMList</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>true</isOutput>
        <objectType>EmailMessage</objectType>
    </variables>
    <variables>
        <name>varFName</name>
        <dataType>String</dataType>
        <isCollection>true</isCollection>
        <isInput>false</isInput>
        <isOutput>true</isOutput>
    </variables>
    <variables>
        <name>varGenesysRecordTypeId</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>true</isOutput>
    </variables>
    <variables>
        <name>varGenesysRoutingId</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>varIsAccountVendor</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>true</isOutput>
    </variables>
    <variables>
        <name>VarIsEmailNew</name>
        <dataType>Boolean</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>varLastAgentId</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>true</isOutput>
    </variables>
    <variables>
        <name>varMediaType</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>varMessageId</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>true</isOutput>
    </variables>
    <variables>
        <name>varObj</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>varSFDCFlag</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <value>
            <stringValue></stringValue>
        </value>
    </variables>
    <variables>
        <name>varUserId</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
</Flow>
