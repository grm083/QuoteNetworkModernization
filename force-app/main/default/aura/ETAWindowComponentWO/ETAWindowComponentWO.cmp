<aura:component
  implements="flexipage:availableForAllPageTypes,flexipage:availableForRecordHome,force:hasRecordId,forceCommunity:availableForAllPageTypes,force:lightningQuickAction"
  controller="ETAWindowController"
  access="global"
>
  <aura:attribute name="workOrderRecord" type="Object" /> 
  <aura:attribute name="etaStatusServiceLst" type="StatusWrapper[]" />
  <aura:attribute name="statusColumns" type="List" />
  <aura:attribute name="assetOptions" type="String[]" default="" />
  <aura:attribute name="selectedAsset" type="String" />
  <aura:attribute name="disable" type="Boolean" default="true" />
  <!-- <aura:handler name="init" value="{!this }" action="{!c.initAction }" /> -->
  <aura:attribute name="IsSpinner" type="Boolean"/>
   
  	<force:recordData aura:id="recordLoader" recordId="{!v.recordId}" targetFields="{!v.workOrderRecord}"
        fields="Id,CaseId,Case.Status,Case.Acorn_Work_order__c,Case.Case_Type__c,Case.Case_Sub_Type__c,Case.Contact.Name"
        mode="VIEW" recordUpdated="{!c.initAction}" />
    
  <div class="slds-grid slds-wrap">
    <div class="slds-col selection slds-size_1-of-4">
      <lightning:select
        aura:id="selectAsset"
        name="selectAsset"
        onchange="{!c.onChange}"
        variant="label-hidden"
        class="label-hidden"
      >
        <aura:iteration items="{!v.assetOptions}" var="asset">
          <option
            text="{!asset.assetLabel}"
            value="{!asset.assetValue}"
          ></option>
        </aura:iteration>
      </lightning:select>
    </div>
    <div class="slds-col slds-size_1-of-4">
      <lightning:button
        variant="brand"
        label="Select for ETA"
        onclick="{!c.getETAStatus}"
        disabled="{!v.disable}"
      />      
      <lightning:button
        variant="destructive"                     
        label= "Report Service Issue"
        onclick="{!c.ManualTaskInvocation}"                      
      />            
    </div>
  </div>

  <div class="slds-scrollable">
    <table class="slds-table slds-table--bordered">
      <lightning:accordion>
        <lightning:accordionSection label="Status and ETA Service">
          <thead>
            <tr>
              <aura:iteration items="{!v.statusColumns}" var="col">
                <th>{!col.label}</th>
              </aura:iteration>
            </tr>
          </thead>
          <tbody>
            <aura:iteration items="{!v.etaStatusServiceLst}" var="data">
              <tr
                class="{!data.isCurrentService ? 'highlight' : 'nohighlight'}"
              >
                <td>{!data.serviceDate}</td>
                <td>{!data.assetName}</td>
                <td>{!data.etaWindow}</td>
                <td>{!data.truckPosition}</td>
                <td>{!data.customerPosition}</td>
                <td>{!data.serviceStatus}</td>
                <td>{!data.exceptionReason}</td>
                <td>{!data.serviceStatusDate}</td>
                <td>{!data.rescheduleDate}</td>
                <td>{!data.woNumber}</td>
                <td>{!data.materialTypeName}</td>
                <td>{!data.occurrenceType}</td>
                <td>{!data.imageUrl}</td>
                <td>{!data.serviceOfferingDefinitionId}</td>
                <td>{!data.woDescription}</td>
                <td>{!data.vendorCode}</td>
                <td>{!data.vendorName}</td>
                <td>{!data.scheduleType}</td>
                <td>{!data.masUniqueId}</td>
                <td>{!data.vendorAccountNumber}</td>
              </tr>
            </aura:iteration>
          </tbody>
        </lightning:accordionSection>
      </lightning:accordion>
    </table>
  </div>

  <aura:if isTrue="{!v.IsSpinner}">
    <lightning:spinner variant="brand"/>
  </aura:if>
    <div aura:id="ManualTaskCreationComp"></div>
</aura:component>